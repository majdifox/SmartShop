{
  "info": {
    "name": "SmartShop_croiser",
    "description": "Complete test suite covering all PDF requirements",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080/api"
    },
    {
      "key": "newClientId",
      "value": ""
    },
    {
      "key": "newOrderId",
      "value": ""
    },
    {
      "key": "newPaymentId",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "PHASE 1 - Authentication",
      "item": [
        {
          "name": "1.1 Login ADMIN ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "const r = pm.response.json();",
                  "pm.test('Has userId', () => pm.expect(r.userId).to.exist);",
                  "pm.test('Role ADMIN', () => pm.expect(r.role).to.eql('ADMIN'));",
                  "pm.test('clientId null for admin', () => pm.expect(r.clientId).to.be.oneOf([null, undefined]));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "1.2 Login CLIENT ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "const r = pm.response.json();",
                  "pm.test('Role CLIENT', () => pm.expect(r.role).to.eql('CLIENT'));",
                  "pm.test('Has clientId', () => pm.expect(r.clientId).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"amine_tech\",\n  \"password\": \"pass123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "1.3 Login Wrong Password ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 403', () => pm.response.to.have.status(403));",
                  "pm.test('Has error message', () => pm.expect(pm.response.json().message).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"wrongpass\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "1.4 Get Current User ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has username', () => pm.expect(pm.response.json().username).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            }
          }
        },
        {
          "name": "1.5 Logout ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            }
          }
        }
      ]
    },
    {
      "name": "PHASE 2 - Client Management",
      "item": [
        {
          "name": "LOGIN ADMIN",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Admin logged', () => pm.response.to.have.status(200));"]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "2.1 Create Client ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "const r = pm.response.json();",
                  "pm.test('Has ID', () => pm.expect(r.id).to.exist);",
                  "pm.test('Tier BASIC', () => pm.expect(r.tier).to.eql('BASIC'));",
                  "pm.test('TotalOrders 0', () => pm.expect(r.totalOrders).to.eql(0));",
                  "pm.collectionVariables.set('newClientId', r.id);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"AutoTest Company\",\n  \"email\": \"autotest@test.ma\",\n  \"phone\": \"0678901234\",\n  \"address\": \"Rabat Test\",\n  \"username\": \"autotest_user\",\n  \"password\": \"pass123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients",
              "host": ["{{baseUrl}}"],
              "path": ["clients"]
            }
          }
        },
        {
          "name": "2.2 Create Client Duplicate Email ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 422', () => pm.response.to.have.status(422));",
                  "pm.test('Error mentions email', () => pm.expect(pm.response.json().message).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Duplicate Test\",\n  \"email\": \"amine@techsolutions.ma\",\n  \"username\": \"dup_user\",\n  \"password\": \"pass123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients",
              "host": ["{{baseUrl}}"],
              "path": ["clients"]
            }
          }
        },
        {
          "name": "2.3 Get All Clients ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Array returned', () => pm.expect(pm.response.json()).to.be.an('array'));",
                  "pm.test('At least 5 clients', () => pm.expect(pm.response.json().length).to.be.at.least(5));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/clients",
              "host": ["{{baseUrl}}"],
              "path": ["clients"]
            }
          }
        },
        {
          "name": "2.4 Get Client by ID ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "const r = pm.response.json();",
                  "pm.test('Has tier', () => pm.expect(r.tier).to.exist);",
                  "pm.test('Has totalOrders', () => pm.expect(r.totalOrders).to.exist);",
                  "pm.test('Has totalSpent', () => pm.expect(r.totalSpent).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/clients/2",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "2"]
            }
          }
        },
        {
          "name": "2.5 Update Client ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Name updated', () => pm.expect(pm.response.json().name).to.eql('Updated Name'));"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated Name\",\n  \"email\": \"amine@techsolutions.ma\",\n  \"phone\": \"0612345678\",\n  \"address\": \"Casablanca Updated\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/1",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "1"]
            }
          }
        },
        {
          "name": "2.6 Get Client Order History ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Array returned', () => pm.expect(pm.response.json()).to.be.an('array'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/clients/2/orders",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "2", "orders"]
            }
          }
        }
      ]
    },
    {
      "name": "PHASE 3 - Product Management",
      "item": [
        {
          "name": "LOGIN ADMIN",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Admin logged', () => pm.response.to.have.status(200));"]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "3.1 Create Product ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "const r = pm.response.json();",
                  "pm.test('Has ID', () => pm.expect(r.id).to.exist);",
                  "pm.test('Has stock', () => pm.expect(r.stock).to.eql(50));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Product Auto\",\n  \"description\": \"Automated test product\",\n  \"unitPrice\": 500.00,\n  \"stock\": 50\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/products",
              "host": ["{{baseUrl}}"],
              "path": ["products"]
            }
          }
        },
        {
          "name": "3.2 Get Product by ID ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "const r = pm.response.json();",
                  "pm.test('Has name', () => pm.expect(r.name).to.exist);",
                  "pm.test('Has unitPrice', () => pm.expect(r.unitPrice).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/products/1",
              "host": ["{{baseUrl}}"],
              "path": ["products", "1"]
            }
          }
        },
        {
          "name": "3.3 Get Products Paginated ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "const r = pm.response.json();",
                  "pm.test('Has content', () => pm.expect(r.content).to.be.an('array'));",
                  "pm.test('Has totalElements', () => pm.expect(r.totalElements).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/products?page=0&size=5",
              "host": ["{{baseUrl}}"],
              "path": ["products"],
              "query": [
                {"key": "page", "value": "0"},
                {"key": "size", "value": "5"}
              ]
            }
          }
        },
        {
          "name": "3.4 Search Products ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Returns page', () => pm.expect(pm.response.json().content).to.be.an('array'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/products?search=Laptop&page=0&size=10",
              "host": ["{{baseUrl}}"],
              "path": ["products"],
              "query": [
                {"key": "search", "value": "Laptop"},
                {"key": "page", "value": "0"},
                {"key": "size", "value": "10"}
              ]
            }
          }
        },
        {
          "name": "3.5 Update Product ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Name updated', () => pm.expect(pm.response.json().name).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated Product Name\",\n  \"description\": \"Updated description\",\n  \"unitPrice\": 5600.00,\n  \"stock\": 20\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/products/1",
              "host": ["{{baseUrl}}"],
              "path": ["products", "1"]
            }
          }
        },
        {
          "name": "3.6 Delete Product (soft) ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/products/11",
              "host": ["{{baseUrl}}"],
              "path": ["products", "11"]
            }
          }
        }
      ]
    },
    {
      "name": "PHASE 4 - Orders & Calculations",
      "item": [
        {
          "name": "LOGIN ADMIN",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Admin logged', () => pm.response.to.have.status(200));"]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "4.1 Order BASIC (0% discount) ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "const r = pm.response.json();",
                  "pm.test('Has subtotalHT', () => pm.expect(r.subtotalHT).to.exist);",
                  "pm.test('Loyalty discount 0', () => pm.expect(r.loyaltyDiscount).to.eql(0));",
                  "pm.test('Has items', () => pm.expect(r.items).to.be.an('array'));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": 1,\n  \"items\": [\n    {\n      \"productId\": 3,\n      \"quantity\": 2\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          }
        },
        {
          "name": "4.2 Order SILVER (5% discount) ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "const r = pm.response.json();",
                  "pm.test('Has loyalty discount', () => pm.expect(r.loyaltyDiscount).to.be.above(0));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": 2,\n  \"items\": [\n    {\n      \"productId\": 6,\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          }
        },
        {
          "name": "4.3 Order GOLD (10% discount) ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "const r = pm.response.json();",
                  "pm.test('Loyalty discount applied', () => pm.expect(r.loyaltyDiscount).to.be.above(0));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": 3,\n  \"items\": [\n    {\n      \"productId\": 2,\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          }
        },
        {
          "name": "4.4 Order PLATINUM (15%) + Store ID ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "const r = pm.response.json();",
                  "pm.test('Has ID', () => pm.expect(r.id).to.exist);",
                  "pm.test('Loyalty discount max', () => pm.expect(r.loyaltyDiscount).to.be.above(0));",
                  "pm.collectionVariables.set('newOrderId', r.id);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": 4,\n  \"items\": [\n    {\n      \"productId\": 1,\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          }
        },
        {
          "name": "4.5 Order with Promo Code ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "const r = pm.response.json();",
                  "pm.test('Has promo discount', () => pm.expect(r.promoDiscount).to.be.above(0));",
                  "pm.test('Has loyalty discount', () => pm.expect(r.loyaltyDiscount).to.exist);",
                  "pm.test('Total discount sum', () => pm.expect(r.totalDiscount).to.eql(r.loyaltyDiscount + r.promoDiscount));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": 3,\n  \"promoCode\": \"PROMO-TEST\",\n  \"items\": [\n    {\n      \"productId\": 2,\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          }
        },
        {
          "name": "4.6 Order Insufficient Stock ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 422', () => pm.response.to.have.status(422));",
                  "pm.test('Error mentions stock', () => pm.expect(pm.response.json().message).to.include('stock'));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": 1,\n  \"items\": [\n    {\n      \"productId\": 1,\n      \"quantity\": 999\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          }
        },
        {
          "name": "4.7 Order No Items ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 422', () => pm.response.to.have.status(422));",
                  "pm.test('Error exists', () => pm.expect(pm.response.json().message || pm.response.json().error).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": 1,\n  \"items\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          }
        },
        {
          "name": "4.8 Get Order by ID ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "const r = pm.response.json();",
                  "pm.test('Has clientId', () => pm.expect(r.clientId).to.exist);",
                  "pm.test('Has status', () => pm.expect(r.status).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/orders/3",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "3"]
            }
          }
        },
        {
          "name": "4.9 Get All Orders ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Array returned', () => pm.expect(pm.response.json()).to.be.an('array'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          }
        },
        {
          "name": "4.10 Confirm Order Not Paid ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 422', () => pm.response.to.have.status(422));",
                  "pm.test('Error mentions payment', () => pm.expect(pm.response.json().message).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "url": {
              "raw": "{{baseUrl}}/orders/3/confirm",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "3", "confirm"]
            }
          }
        },
        {
          "name": "4.11 Confirm Fully Paid Order ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Status CONFIRMED', () => pm.expect(pm.response.json().status).to.eql('CONFIRMED'));"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "url": {
              "raw": "{{baseUrl}}/orders/7/confirm",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "7", "confirm"]
            }
          }
        },
        {
          "name": "4.12 Cancel Order ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Status CANCELED', () => pm.expect(pm.response.json().status).to.eql('CANCELED'));"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "url": {
              "raw": "{{baseUrl}}/orders/4/cancel",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "4", "cancel"]
            }
          }
        }
      ]
    },
    {
      "name": "PHASE 5 - Payment System",
      "item": [
        {
          "name": "LOGIN ADMIN",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Admin logged', () => pm.response.to.have.status(200));"]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "5.1 Add CASH Payment + Store ID ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "const r = pm.response.json();",
                  "pm.test('Has ID', () => pm.expect(r.id).to.exist);",
                  "pm.test('Has paymentNumber', () => pm.expect(r.paymentNumber).to.exist);",
                  "pm.test('OrderId matches', () => pm.expect(r.orderId).to.eql(Number(pm.collectionVariables.get('newOrderId'))));",
                  "pm.collectionVariables.set('newPaymentId', r.id);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 1000.00,\n  \"paymentMethod\": \"CASH\",\n  \"reference\": \"AUTO-TEST-CASH-001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders/{{newOrderId}}/payments",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{newOrderId}}", "payments"]
            }
          }
        },
        {
          "name": "5.2 Get Order Payments ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "const arr = pm.response.json();",
                  "pm.test('Array returned', () => pm.expect(arr).to.be.an('array'));",
                  "pm.test('At least 1 payment', () => pm.expect(arr.length).to.be.at.least(1));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/orders/{{newOrderId}}/payments",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{newOrderId}}", "payments"]
            }
          }
        },
        {
          "name": "5.3 CASH > 20000 DH Limit ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 422', () => pm.response.to.have.status(422));",
                  "pm.test('Error mentions limit', () => pm.expect(pm.response.json().message).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 25000.00,\n  \"paymentMethod\": \"CASH\",\n  \"reference\": \"ERROR-OVER-LIMIT\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders/3/payments",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "3", "payments"]
            }
          }
        },
        {
          "name": "5.4 Update Payment Status ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Status field exists', () => pm.expect(pm.response.json().status).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "url": {
              "raw": "{{baseUrl}}/payments/{{newPaymentId}}/status?status=ENCAISSE",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "{{newPaymentId}}", "status"],
              "query": [
                {"key": "status", "value": "ENCAISSE"}
              ]
            }
          }
        },
        {
          "name": "5.5 Get Pending Payments ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Array returned', () => pm.expect(pm.response.json()).to.be.an('array'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/payments/pending",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "pending"]
            }
          }
        },
        {
          "name": "5.6 Get Payment by ID ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('ID matches', () => pm.expect(pm.response.json().id).to.eql(Number(pm.collectionVariables.get('newPaymentId'))));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/payments/{{newPaymentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "{{newPaymentId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "PHASE 6 - Promo Codes",
      "item": [
        {
          "name": "LOGIN ADMIN",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Admin logged', () => pm.response.to.have.status(200));"]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "6.1 Create Promo Code ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has code', () => pm.expect(pm.response.json().code).to.exist);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"PROMO-AUTO\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/promo-codes",
              "host": ["{{baseUrl}}"],
              "path": ["promo-codes"]
            }
          }
        },
        {
          "name": "6.2 Get All Promo Codes ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Array returned', () => pm.expect(pm.response.json()).to.be.an('array'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/promo-codes",
              "host": ["{{baseUrl}}"],
              "path": ["promo-codes"]
            }
          }
        }
      ]
    }
  ]
}
